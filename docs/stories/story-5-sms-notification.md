# Story 5: 신규 매물 SMS 알림

## Status
- Draft

## Story
**As a** 로그인한 사용자,
**I want** 나의 '구매 희망 범위'에 맞는 새 매물이 등록되면 SMS 알림을 받고 싶다,
**so that** 좋은 기회를 놓치지 않을 수 있다.

## Acceptance Criteria
1.  새로운 매물이 시스템에 추가될 때, 시스템은 해당 매물이 저장된 모든 '구매 희망 범위'와 일치하는지 검사한다. (FR4)
2.  일치하는 구독을 가진 사용자에게 SMS 알림을 발송한다.
3.  SMS에는 매물의 핵심 정보(차종, 가격 등)와 상세 페이지 링크가 포함된다.
4.  사용자는 '알림 설정 페이지'에서 전체 SMS 알림 수신 여부를 켜거나 끌 수 있다.
5.  SMS 발송은 비동기적으로 처리되어야 하며, 다른 시스템에 영향을 주지 않아야 한다.

## Tasks / Subtasks
- [ ] **Task 1: 알림 대상 탐색 로직 개발**
    - [ ] 신규 매물 정보를 입력받아, 해당 매물과 일치하는 모든 구독을 데이터베이스에서 조회하는 로직 구현 (참고: `8-core-workflows.md`)
- [ ] **Task 2: SMS 발송 서비스 구현**
    - [ ] 외부 SMS Gateway(예: Twilio) 연동 모듈 개발
    - [ ] 조회된 구독자 목록을 순회하며 SMS를 발송하는 로직 구현
    - [ ] SMS 메시지 템플릿(매물 정보, 링크 포함) 작성
- [ ] **Task 3: 백그라운드 작업 처리 시스템 구축**
    - [ ] 데이터 수집 프로세스(IngestionSvc)가 신규 매물 등록 후 알림 서비스(NotificationSvc)를 호출하도록 워크플로우 구성 (참고: `8-core-workflows.md`)
    - [ ] 알림 발송 작업이 비동기적으로 실행되도록 메시지 큐(예: RabbitMQ, SQS) 또는 간단한 백그라운드 잡 프로세서 도입 고려
- [ ] **Task 4: SMS 수신 동의/거부 기능 구현**
    - [ ] '알림 설정 페이지'에 SMS 전체 수신 동의/거부 체크박스 UI 추가
    - [ ] 사용자의 수신 동의 상태를 `users` 테이블에 저장하고, 알림 발송 시 이 상태를 확인하는 로직 추가

## Dev Notes
- **External Services:**
    - SMS Gateway는 비용과 안정성을 고려하여 선정한다. API 키 등 민감 정보는 환경 변수로 안전하게 관리한다.
- **System Architecture:**
    - `8-core-workflows.md`의 시퀀스 다이어그램에 따라 데이터 수집, 데이터 서비스, 알림 서비스 간의 상호작용을 구현한다.
    - 대량 알림 발송 시 성능 저하를 막기 위해 비동기 처리 방식을 반드시 적용해야 한다. (NFR3)

## Change Log
| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2025-09-30 | 1.0 | 스토리 초안 작성 | Gemini |
